## –í–æ–ø—Ä–æ—Å: –ü—Ä–æ–±–ª–µ–º–∞ N+1

**–ü—Ä–æ–±–ª–µ–º–∞ N+1** ‚Äî —ç—Ç–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω–∞—è **–∞–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö –∏ ORM (–Ω–∞–ø—Ä–∏–º–µ—Ä, Hibernate –≤ Java), –∫–æ–≥–¥–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **1 –∑–∞–ø—Ä–æ—Å –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ + N –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π —Å–≤—è–∑–∞–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏**, –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.

---

## üìå –ü—Ä–∏–º–µ—Ä –Ω–∞ Java + Hibernate

–î–æ–ø—É—Å—Ç–∏–º, —É —Ç–µ–±—è –µ—Å—Ç—å —Å—É—â–Ω–æ—Å—Ç–∏:

```java
@Entity
public class Author {
    @Id
    private Long id;
    private String name;

    @OneToMany(mappedBy = "author")
    private List<Book> books; // lazy loading –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
}

@Entity
public class Book {
    @Id
    private Long id;
    private String title;

    @ManyToOne
    private Author author;
}
```

–¢—ã —Ö–æ—á–µ—à—å –≤—ã–≤–µ—Å—Ç–∏ –≤—Å–µ—Ö –∞–≤—Ç–æ—Ä–æ–≤ –∏ –∏—Ö –∫–Ω–∏–≥–∏:

```java
List<Author> authors = authorRepository.findAll(); // 1 –∑–∞–ø—Ä–æ—Å: SELECT * FROM author

for (Author author : authors) {
    System.out.println(author.getName());
    for (Book book : author.getBooks()) { // ‚Üê –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ books ‚Äî –¥–µ–ª–∞–µ—Ç—Å—è SELECT –∏–∑ book
        System.out.println("  - " + book.getTitle());
    }
}
```

### ‚ùå –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
- 1 –∑–∞–ø—Ä–æ—Å ‚Äî –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –∞–≤—Ç–æ—Ä–æ–≤ (`SELECT * FROM author`)
- N –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Äî –ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ –∫–∞–∂–¥–æ–≥–æ –∞–≤—Ç–æ—Ä–∞:  
  `SELECT * FROM book WHERE author_id = ?`

–ï—Å–ª–∏ –∞–≤—Ç–æ—Ä–æ–≤ 100 ‚Üí **101 –∑–∞–ø—Ä–æ—Å –∫ –ë–î** ‚Üí –º–µ–¥–ª–µ–Ω–Ω–æ, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–µ —Å–µ—Ç–∏.

---

## ‚úÖ –ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å?

### 1. **–ñ–∞–¥–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (JOIN FETCH)**

```java
@Query("SELECT a FROM Author a LEFT JOIN FETCH a.books")
List<Author> findAllWithBooks();
```

‚Üí –í—ã–ø–æ–ª–Ω–∏—Ç—Å—è **–æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å —Å JOIN**:
```sql
SELECT a.*, b.* 
FROM author a 
LEFT JOIN book b ON a.id = b.author_id
```

### 2. **–ü–∞–∫–µ—Ç–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (Batch Fetching)**

–í `application.properties`:
```properties
spring.jpa.properties.hibernate.default_batch_fetch_size=10
```

‚Üí Hibernate —Å–≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã: –≤–º–µ—Å—Ç–æ 100 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö ‚Äî —Å–¥–µ–ª–∞–µ—Ç 10 –ø–∞–∫–µ—Ç–æ–≤ –ø–æ 10 ID.

### 3. **–Ø–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å IN**

```java
List<Long> authorIds = authors.stream().map(Author::getId).collect(Collectors.toList());
List<Book> books = bookRepository.findByAuthorIdIn(authorIds); // –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å
```

‚Üí –ó–∞—Ç–µ–º –≤—Ä—É—á–Ω—É—é —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–∏–≥–∏ –ø–æ –∞–≤—Ç–æ—Ä–∞–º.

---

## üí° –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ?

- **N+1 —É–±–∏–≤–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** –¥–∞–∂–µ –Ω–∞ –Ω–µ–±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö.
- –ü—Ä–æ–±–ª–µ–º–∞ **–Ω–µ –≤–∏–¥–Ω–∞ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î** (–Ω–∏–∑–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞), –Ω–æ **–∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–Ω–∞ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ**.
- ORM (Hibernate) –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–ª–µ–Ω–∏–≤—É—é –∑–∞–≥—Ä—É–∑–∫—É (lazy loading)** ‚Üí –ª–µ–≥–∫–æ —Å–ª—É—á–∞–π–Ω–æ –≤—ã–∑–≤–∞—Ç—å N+1.

---

## ‚úÖ –ö–∞–∫ –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å?

- –í–∫–ª—é—á–∏—Ç—å –ª–æ–≥ SQL:  
  ```properties
  spring.jpa.show-sql=true
  logging.level.org.hibernate.SQL=DEBUG
  ```
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã: **Hibernate Statistics**, **datasource-proxy**, **JPA Buddy**, **Micrometer**.

---

## üìå –í—ã–≤–æ–¥:

> **–ü—Ä–æ–±–ª–µ–º–∞ N+1** ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∫ –ë–î –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **1 + N –º–µ–ª–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ä–µ–∑–∫–æ–º—É –ø–∞–¥–µ–Ω–∏—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.  
> –†–µ—à–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ **–∂–∞–¥–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É**, **–ø–∞–∫–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** –∏–ª–∏ **—Ä—É—á–Ω—É—é –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –∑–∞–ø—Ä–æ—Å–æ–≤**.
